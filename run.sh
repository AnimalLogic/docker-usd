#!/bin/sh
extra_volumes=$(cat <<-END
    -v="/usr/lib64/libGL.so:/usr/lib64/libGL.so:ro"
    -v="/usr/lib64/libGL.so.1:/usr/lib64/libGL.so.1:ro"
    -v="/usr/lib64/libGL.so.1.0:/usr/lib64/libGL.so.1.0:ro"
    -v="/usr/lib64/libGLX.so:/usr/lib64/libGLX.so:ro"
    -v="/usr/lib64/libGLX.so.0:/usr/lib64/libGLX.so.0:ro"
    -v="/usr/lib64/libGLX_indirect.so.0:/usr/lib64/libGLX_indirect.so.0:ro"
    -v="/usr/lib64/libGLX_nvidia.so.0:/usr/lib64/libGLX_nvidia.so.0:ro"
    -v="/usr/lib64/libGLX_nvidia.so.375.20:/usr/lib64/libGLX_nvidia.so.375.20:ro"
    -v="/usr/lib64/libGLdispatch.so.0:/usr/lib64/libGLdispatch.so.0:ro"
    -v="/usr/lib64/libcuda.so.1:/usr/lib64/libcuda.so.1:ro"
    -v="/usr/lib64/libcuda.so.375.20:/usr/lib64/libcuda.so.375.20:ro"
    -v="/usr/lib64/libEGL_nvidia.so.0:/usr/lib64/libEGL_nvidia.so.0:ro"
    -v="/usr/lib64/libEGL_nvidia.so.375.20:/usr/lib64/libEGL_nvidia.so.375.20:ro"
    -v="/usr/lib64/libGLESv1_CM_nvidia.so.1:/usr/lib64/libGLESv1_CM_nvidia.so.1:ro"
    -v="/usr/lib64/libGLESv1_CM_nvidia.so.375.20:/usr/lib64/libGLESv1_CM_nvidia.so.375.20:ro"
    -v="/usr/lib64/libGLESv2_nvidia.so.2:/usr/lib64/libGLESv2_nvidia.so.2:ro"
    -v="/usr/lib64/libGLESv2_nvidia.so.375.20:/usr/lib64/libGLESv2_nvidia.so.375.20:ro"
    -v="/usr/lib64/libnvcuvid.so.1:/usr/lib64/libnvcuvid.so.1:ro"
    -v="/usr/lib64/libnvcuvid.so.375.20:/usr/lib64/libnvcuvid.so.375.20:ro"
    -v="/usr/lib64/libnvidia-cfg.so:/usr/lib64/libnvidia-cfg.so:ro"
    -v="/usr/lib64/libnvidia-cfg.so.1:/usr/lib64/libnvidia-cfg.so.1:ro"
    -v="/usr/lib64/libnvidia-cfg.so.375.20:/usr/lib64/libnvidia-cfg.so.375.20:ro"
    -v="/usr/lib64/libnvidia-compiler.so.375.20:/usr/lib64/libnvidia-compiler.so.375.20:ro"
    -v="/usr/lib64/libnvidia-eglcore.so.375.20:/usr/lib64/libnvidia-eglcore.so.375.20:ro"
    -v="/usr/lib64/libnvidia-egl-wayland.so.375.20:/usr/lib64/libnvidia-egl-wayland.so.375.20:ro"
    -v="/usr/lib64/libnvidia-encode.so:/usr/lib64/libnvidia-encode.so:ro"
    -v="/usr/lib64/libnvidia-encode.so.1:/usr/lib64/libnvidia-encode.so.1:ro"
    -v="/usr/lib64/libnvidia-encode.so.375.20:/usr/lib64/libnvidia-encode.so.375.20:ro"
    -v="/usr/lib64/libnvidia-fatbinaryloader.so.375.20:/usr/lib64/libnvidia-fatbinaryloader.so.375.20:ro"
    -v="/usr/lib64/libnvidia-fbc.so:/usr/lib64/libnvidia-fbc.so:ro"
    -v="/usr/lib64/libnvidia-fbc.so.1:/usr/lib64/libnvidia-fbc.so.1:ro"
    -v="/usr/lib64/libnvidia-fbc.so.375.20:/usr/lib64/libnvidia-fbc.so.375.20:ro"
    -v="/usr/lib64/libnvidia-glcore.so.375.20:/usr/lib64/libnvidia-glcore.so.375.20:ro"
    -v="/usr/lib64/libnvidia-glsi.so.375.20:/usr/lib64/libnvidia-glsi.so.375.20:ro"
    -v="/usr/lib64/libnvidia-gtk2.so.375.20:/usr/lib64/libnvidia-gtk2.so.375.20:ro"
    -v="/usr/lib64/libnvidia-gtk3.so.375.20:/usr/lib64/libnvidia-gtk3.so.375.20:ro"
    -v="/usr/lib64/libnvidia-ifr.so:/usr/lib64/libnvidia-ifr.so:ro"
    -v="/usr/lib64/libnvidia-ifr.so.1:/usr/lib64/libnvidia-ifr.so.1:ro"
    -v="/usr/lib64/libnvidia-ifr.so.375.20:/usr/lib64/libnvidia-ifr.so.375.20:ro"
    -v="/usr/lib64/libnvidia-ml.so:/usr/lib64/libnvidia-ml.so:ro"
    -v="/usr/lib64/libnvidia-ml.so.1:/usr/lib64/libnvidia-ml.so.1:ro"
    -v="/usr/lib64/libnvidia-ml.so.375.20:/usr/lib64/libnvidia-ml.so.375.20:ro"
    -v="/usr/lib64/libnvidia-opencl.so.1:/usr/lib64/libnvidia-opencl.so.1:ro"
    -v="/usr/lib64/libnvidia-opencl.so.375.20:/usr/lib64/libnvidia-opencl.so.375.20:ro"
    -v="/usr/lib64/libnvidia-ptxjitcompiler.so.375.20:/usr/lib64/libnvidia-ptxjitcompiler.so.375.20:ro"
    -v="/usr/lib64/libnvidia-tls.so.375.20:/usr/lib64/libnvidia-tls.so.375.20:ro"
    -v="/usr/lib64/libschroedinger-1.0.so.0.10.0:/usr/lib64/libschroedinger-1.0.so.0.10.0:ro"
    -v="/usr/lib64/libvdpau_nvidia.so:/usr/lib64/libvdpau_nvidia.so:ro"
    -v="/usr/lib64/vdpau/libvdpau_nvidia.so.375.20:/usr/lib64/vdpau/libvdpau_nvidia.so.375.20:ro"
END
)

docker run --name "usd-7.1" --rm -it -e "DISPLAY=unix:0.0" -v="/tmp/.X11-unix:/tmp/.X11-unix:rw" -v="$HOME:/home/usd:rw" ${extra_volumes} "usd-docker/usd:7.1" "$@"
